<main class="main">
  <mat-toolbar color="primary">
    Banner editor
  </mat-toolbar>
  <div class="main__content container">
    <div class="preview _container">
      <div class="preview">
        <div class="preview__title">
          <h3 class="title-preview">Заголовок превью</h3>
        </div>
        <div class="preview__body body-preview">
          <div class="body-preview__wrap" #content
            [style]="{width: parameterForm.get('width').value + 6 + 'px',height: parameterForm.get('height').value + 6 + 'px'}">
            <div #screen class="preview__body-content" [style]="{
              width: parameterForm.get('width').value + 'px',
              height: parameterForm.get('height').value + 'px',
              backgroundRepeat: !parameterForm.get('bgGradient').value && 'no-repeat',
              backgroundImage: 'url(' + cardImageBase64 + ')',
              backgroundColor: defaultColor,
              background: parameterForm.get('bgGradient').value
                ? 'linear-gradient(' +
                  parameterForm.get('colorDirection').value +
                  'deg, ' +
                  defaultColor +
                  ', ' +
                  defaultGradientColor +
                  ')'
                : '',
              backgroundPosition: parameterForm.get('imgPosition').value,
              backgroundSize: parameterForm.get('imgCover').value
            }">
              <pre [style]="{
                  display: 'block',
                  position: 'absolute',
                  width: parameterForm.get('widthText').value + 'px',
                  lineHeight: lineHeightDefault,
                  maxHeight: parameterForm.get('fontSize').value * lineHeightDefault * maxLinesOfText + 'px',
                  whiteSpace: 'pre-wrap',
                  wordWrap: 'break-word',
                  overflow: 'hidden',
                  textAlign: parameterForm.get('textAlign').value,
                  fontFamily: parameterForm.get('fontFamily').value,
                  fontSize: parameterForm.get('fontSize').value + 'px',
                  fontWeight: parameterForm.get('fontWeight').value,
                  color: defaultTextColor
                }" cdkDragBoundary=".preview__body-content" cdkDrag>{{ parameterForm.get('text').value }}</pre>
              <a [href]="'http://' + parameterForm.get('link').value" class="banner-link" target="_blank"
                style="display: block; height: 100%;"></a>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="parameters _container">
      <div class="parameter-forms">
        <div class="parameter__title">
          <h3 class="title-parameter">Параметры</h3>
        </div>
        <div [formGroup]="parameterForm" class="parameter__content content-parameter">
          <div class="content-parameter__size">
            <p class="size-title">Задание размеров макета в пикселях</p>
            <div class="content-size__items">
              <div class="content-size__item">
                <mat-label class="size-label" for="horizontal">
                  Ширина макета:
                </mat-label>
                <mat-form-field class="size-input">
                  <input matInput type="number" min="100" max="500" formControlName="width" />
                </mat-form-field>
              </div>
              <div class="content-size__item">
                <mat-label class="size-label" for="vertical">
                  Высота макета:
                </mat-label>
                <mat-form-field class="size-input">
                  <input matInput id="vertical" type="number" min="100" max="500" formControlName="height" />
                </mat-form-field>
              </div>
            </div>
          </div>

          <div class="content-parameter__image">
            <mat-form-field class="mat-form-upload">
              <mat-label>Выберите изображение для загрузки</mat-label>
              <ngx-mat-file-input id="uploadImage" formControlName="bgImage" (change)="previewFile($event)">
              </ngx-mat-file-input>
              <mat-icon matSuffix>folder</mat-icon>
            </mat-form-field>
          </div>

          <div class="image-position">
            <mat-form-field appearance="fill">
              <mat-label>Расположение</mat-label>
              <mat-select disableRipple formControlName="imgPosition">
                <mat-option *ngFor="let position of bgPosOptions" [value]="position[1]">
                  {{ position[0] }}
                </mat-option>
              </mat-select>
            </mat-form-field>
            <mat-form-field appearance="fill">
              <mat-label>Размер</mat-label>
              <mat-select formControlName="imgCover">
                <mat-option>Исходный</mat-option>
                <mat-option *ngFor="let size of bgSizeOptions" [value]="size[1]">
                  {{ size[0] }}
                </mat-option>
              </mat-select>
            </mat-form-field>
          </div>

          <div class="choice-color__option option-color">
            <mat-form-field appearance="fill">
              <label for="colorFrom"> Выберите цвет фона </label>
              <input matInput id="colorFrom" class="choice-color color-input" [(colorPicker)]="defaultColor"
                [style.background]="defaultColor" formControlName="bgColorFrom" />
            </mat-form-field>
            <mat-checkbox id="gradient" formControlName="bgGradient">Градиент</mat-checkbox>
            <div class="option-color__gradient" *ngIf="parameterForm.get('bgGradient').value">
              <mat-form-field appearance="fill">
                <label for="colorTo"> Второй цвет в градиенте</label>
                <input matInput id="colorTo" class="choice-color color-input" [(colorPicker)]="defaultGradientColor"
                  [style.background]="defaultGradientColor" formControlName="bgColorTo" />
              </mat-form-field>

              <label for="direction"> Направление </label>
              <mat-slider thumbLabel id="direction" formControlName="colorDirection" [displayWith]="formatLabel"
                vertical="true" min="0" max="360"></mat-slider>
            </div>
          </div>
          <div content-parameter__text text-option>
            <div class="text-option__input">
              <mat-form-field appearance="fill">
                <mat-label>Введите текст баннера</mat-label>
                <textarea matInput id="text" class="text-field" [placeholder]="textAreaPlaceholder" rows="3"
                  formControlName="text"></textarea>
                <div *ngIf="parameterForm.hasError('required','text') && parameterForm.controls['text'].touched">
                  Это поле обязательно для заполнения
                </div>
              </mat-form-field>
            </div>
            <div class="text-option__setting">
              <div class="setting-option__items" *ngFor="let item of textConfigList">
                <mat-form-field appearance="fill">
                  <mat-label>{{item.default}}</mat-label>
                  <mat-select formControlName={{item.control}}>
                    <mat-option *ngFor="let value of item.selectValue; let i = index" [value]="item.styleValue[i]">
                      {{value}}
                    </mat-option>

                  </mat-select>
                </mat-form-field>
              </div>
              <mat-label for="width-text"> Ширина текста </mat-label>
              <mat-slider #widthTextValue thumbLabel id="width-text" formControlName="widthText"
                [displayWith]="formatLabelWidth" min="50" [max]="parameterForm.get('width').value">
              </mat-slider>

              <mat-form-field appearance="fill">
                <label for="color-text"> Цвет текста </label>
                <input matInput id="color-text" class="choice-color color-text" [(colorPicker)]="defaultTextColor"
                  [style.background]="defaultTextColor" formControlName="textColor" />
              </mat-form-field>

              <!-- <label for="color-text"> Цвет текста </label>
              <input id="color-text" class="choice-color color-text" [(colorPicker)]="defaultTextColor"
                [style.background]="defaultTextColor" formControlName="textColor" /> -->

            </div>
          </div>
          <div>
            <label for="url">Ссылка для баннера: http://</label>
            <input id="link" type="text" [placeholder]="inputLinkPlaceholder" formControlName="link" />
            <div *ngIf="parameterForm.hasError('required','link') && parameterForm.controls['link'].touched">
              Заполните url
            </div>
          </div>
        </div>
      </div>
      <div class="export">
        <div class="export__title">
          <h3 class="title-export">Экспорт баннера</h3>
        </div>
        <div class="export__buttons" #container>
          <button class="to__png" (click)="downloadImage()" [disabled]="parameterForm.invalid">в PNG</button>
          <button class="to__html" (click)="copyContent()" [disabled]="parameterForm.invalid">в
            HTML</button>
          <button class="to__json" (click)="copyConfig()" [disabled]="parameterForm.invalid">в JSON</button>
        </div>
        <p>
          Form Status: {{ parameterForm.status }}
        </p>
      </div>
    </div>
  </div>
  <div id="download">
    <img #canvas>
    <a #downloadLink></a>
  </div>
</main>
